# MultiAgentPPTï¼šç®€å•ç¤ºä¾‹ç”¨äºç”ŸæˆPPTå¤§çº²

æœ¬é¡¹ç›®ç»“åˆäº† **A2A æ¡†æ¶** ä¸ **Google ADK æ¶æ„**ï¼Œé€šè¿‡ SSEï¼ˆServer-Sent Eventsï¼‰ç”Ÿæˆå¤§çº²

---

## âœ¨ é¡¹ç›®äº®ç‚¹

* ğŸ”— **A2A + ADK æ— ç¼é›†æˆ**ï¼šå®ç°å¤šæ™ºèƒ½ä½“ä»»åŠ¡æ‰§è¡Œã€‚
* ğŸ“„ **æ ‡å‡†åŒ– XML PPT è¾“å‡º**ï¼šæ”¯æŒåŸºäºç»“æ„åŒ–å¤§çº²ç”Ÿæˆå†…å®¹ä¸°å¯Œã€å¸ƒå±€å¤šæ ·çš„ XML æ¼”ç¤ºæ–‡ç¨¿ã€‚
* ğŸŒ **æµå¼å“åº”æ”¯æŒï¼ˆSSEï¼‰**ï¼šæ”¯æŒå®¢æˆ·ç«¯å®æ—¶æ¥æ”¶ Agent æ‰§è¡ŒçŠ¶æ€åŠå†…å®¹æ›´æ–°ã€‚

---

## ğŸ“‚ é¡¹ç›®ç»“æ„è¯´æ˜

| æ–‡ä»¶                      | è¯´æ˜                                |
| ----------------------- | --------------------------------- |
| `a2a_client.py`         | A2A å®¢æˆ·ç«¯å°è£…ï¼Œç®¡ç†ä¸æœåŠ¡ç«¯çš„äº¤äº’               |
| `agent.py`              | ä¸»æ§åˆ¶ Agentï¼Œè°ƒåº¦æ‰§è¡Œä»»åŠ¡                  |
| `main_api.py`           | FastAPI ä¸»å…¥å£ï¼Œæš´éœ² SSE æ¥å£             |
| `adk_agent_executor.py` | å®ç° A2A ä¸ ADK æ¡†æ¶çš„é›†æˆé€»è¾‘              |
| `.env`                  | ç¯å¢ƒå˜é‡é…ç½®ï¼Œéœ€åŒ…å« Google GenAI API å¯†é’¥ç­‰ä¿¡æ¯ |

---

## ğŸ“Œ ç¤ºä¾‹ï¼šä¸»é¢˜ç”Ÿæˆä»»åŠ¡

ä»¥ä¸‹æ˜¯å¯ä»¥æµ‹è¯•çš„å…¸å‹ä¸»é¢˜è¾“å…¥ï¼Œç³»ç»Ÿå°†è‡ªåŠ¨ç”Ÿæˆç»“æ„åŒ–å†…å®¹ï¼š

* ç”µåŠ¨æ±½è½¦å¸‚åœºè°ƒç ”

---

## è¿è¡Œæ–¹æ³•
```
åœ¨.envæ–‡ä»¶ä¸­å…ˆä¿®æ”¹æ¨¡å‹å’Œæ¨¡å‹ä½¿ç”¨çš„key
python main_api.py
```


a2a_client.py è¾“å‡ºç»“æœç¤ºä¾‹:
```
/Users/admin/miniforge3/envs/a2a/bin/python a2a_client.py 
{'id': '00857233-1927-4cd4-ab2d-4714b166967b', 'jsonrpc': '2.0', 'result': {'contextId': 'f9788c09-9cf5-44f3-8f00-aacb4199a0e6', 'final': False, 'kind': 'status-update', 'status': {'state': 'submitted'}, 'taskId': 'd9982ce3-f0de-4901-a21f-250d27448bf1'}}
{'id': '00857233-1927-4cd4-ab2d-4714b166967b', 'jsonrpc': '2.0', 'result': {'contextId': 'f9788c09-9cf5-44f3-8f00-aacb4199a0e6', 'final': False, 'kind': 'status-update', 'status': {'state': 'working'}, 'taskId': 'd9982ce3-f0de-4901-a21f-250d27448bf1'}}
{'id': '00857233-1927-4cd4-ab2d-4714b166967b', 'jsonrpc': '2.0', 'result': {'contextId': 'f9788c09-9cf5-44f3-8f00-aacb4199a0e6', 'final': False, 'kind': 'status-update', 'status': {'message': {'contextId': 'f9788c09-9cf5-44f3-8f00-aacb4199a0e6', 'kind': 'message', 'messageId': 'dfb54739-1445-45be-b1cf-e582c87ec818', 'parts': [{'kind': 'text', 'text': 'Okay'}], 'role': 'agent', 'taskId': 'd9982ce3-f0de-4901-a21f-250d27448bf1'}, 'state': 'working'}, 'taskId': 'd9982ce3-f0de-4901-a21f-250d27448bf1'}}
{'id': '00857233-1927-4cd4-ab2d-4714b166967b', 'jsonrpc': '2.0', 'result': {'contextId': 'f9788c09-9cf5-44f3-8f00-aacb4199a0e6', 'final': False, 'kind': 'status-update', 'status': {'message': {'contextId': 'f9788c09-9cf5-44f3-8f00-aacb4199a0e6', 'kind': 'message', 'messageId': '66bea100-fc6d-4806-b8a9-c2faec626bf4', 'parts': [{'kind': 'text', 'text': ", here's an outline for a Tesla Car Investigation. This outline could be"}], 'role': 'agent', 'taskId': 'd9982ce3-f0de-4901-a21f-250d27448bf1'}, 'state': 'working'}, 'taskId': 'd9982ce3-f0de-4901-a21f-250d27448bf1'}}
{'id': '00857233-1927-4cd4-ab2d-4714b166967b', 'jsonrpc': '2.0', 'result': {'contextId': 'f9788c09-9cf5-44f3-8f00-aacb4199a0e6', 'final': False, 'kind': 'status-update', 'status': {'message': {'contextId': 'f9788c09-9cf5-44f3-8f00-aacb4199a0e6', 'kind': 'message', 'messageId': 'd12e10df-a838-4ed7-974d-2de69ee05340', 'parts': [{'kind': 'text', 'text': ' used for a news report, a research paper, or even a fictional story. I'}], 'role': 'agent', 'taskId': 'd9982ce3-f0de-4901-a21f-250d27448bf1'}, 'state': 'working'}, 'taskId': 'd9982ce3-f0de-4901-a21f-250d27448bf1'}}
{'id': '00857233-1927-4cd4-ab2d-4714b166967b', 'jsonrpc': '2.0', 'result': {'contextId': 'f9788c09-9cf5-44f3-8f00-aacb4199a0e6', 'final': False, 'kind': 'status-update', 'status': {'message': {'contextId': 'f9788c09-9cf5-44f3-8f00-aacb4199a0e6', 'kind': 'message', 'messageId': '60e2ce89-9e24-4d04-98e7-c7fa5f373ed4', 'parts': [{'kind': 'text', 'text': "'ve tried to cover a range of potential angles.\n\n# Overview of Tesla Cars\n- History of Tesla and its impact on the automotive industry\n- Different"}], 'role': 'agent', 'taskId': 'd9982ce3-f0de-4901-a21f-250d27448bf1'}, 'state': 'working'}, 'taskId': 'd9982ce3-f0de-4901-a21f-250d27448bf1'}}
{'id': '00857233-1927-4cd4-ab2d-4714b166967b', 'jsonrpc': '2.0', 'result': {'contextId': 'f9788c09-9cf5-44f3-8f00-aacb4199a0e6', 'final': False, 'kind': 'status-update', 'status': {'message': {'contextId': 'f9788c09-9cf5-44f3-8f00-aacb4199a0e6', 'kind': 'message', 'messageId': '789a1a5a-ba90-464b-985f-a1fb3f874196', 'parts': [{'kind': 'text', 'text': ' Tesla models and their key features (Model S, 3, X, Y, Cybertruck, etc.)\n- General technological innovations in Tesla vehicles (battery'}], 'role': 'agent', 'taskId': 'd9982ce3-f0de-4901-a21f-250d27448bf1'}, 'state': 'working'}, 'taskId': 'd9982ce3-f0de-4901-a21f-250d27448bf1'}}
{'id': '00857233-1927-4cd4-ab2d-4714b166967b', 'jsonrpc': '2.0', 'result': {'contextId': 'f9788c09-9cf5-44f3-8f00-aacb4199a0e6', 'final': False, 'kind': 'status-update', 'status': {'message': {'contextId': 'f9788c09-9cf5-44f3-8f00-aacb4199a0e6', 'kind': 'message', 'messageId': '13f1a605-982d-4eb6-8478-2dcb113e2b81', 'parts': [{'kind': 'text', 'text': ' tech, Autopilot, etc.)\n\n# Safety Concerns and Investigations\n- Autopilot and Full Self-Driving (FSD) controversies\n  - History of Autopilot accidents and investigations\n  - Debate over the safety and reliability of Autopilot'}], 'role': 'agent', 'taskId': 'd9982ce3-f0de-4901-a21f-250d27448bf1'}, 'state': 'working'}, 'taskId': 'd9982ce3-f0de-4901-a21f-250d27448bf1'}}
{'id': '00857233-1927-4cd4-ab2d-4714b166967b', 'jsonrpc': '2.0', 'result': {'contextId': 'f9788c09-9cf5-44f3-8f00-aacb4199a0e6', 'final': False, 'kind': 'status-update', 'status': {'message': {'contextId': 'f9788c09-9cf5-44f3-8f00-aacb4199a0e6', 'kind': 'message', 'messageId': 'b7940a1a-7c1e-4edb-a4cc-1d4830811b92', 'parts': [{'kind': 'text', 'text': '/FSD\n  - Regulatory scrutiny from NHTSA, NTSB, and other agencies\n- Battery fires and safety\n  - Instances of battery fires in Tesla vehicles\n  - Investigation into the cause of these fires\n  -'}], 'role': 'agent', 'taskId': 'd9982ce3-f0de-4901-a21f-250d27448bf1'}, 'state': 'working'}, 'taskId': 'd9982ce3-f0de-4901-a21f-250d27448bf1'}}
{'id': '00857233-1927-4cd4-ab2d-4714b166967b', 'jsonrpc': '2.0', 'result': {'contextId': 'f9788c09-9cf5-44f3-8f00-aacb4199a0e6', 'final': False, 'kind': 'status-update', 'status': {'message': {'contextId': 'f9788c09-9cf5-44f3-8f00-aacb4199a0e6', 'kind': 'message', 'messageId': 'e6bf93a0-8f7f-4105-8e7c-8b8f1962f566', 'parts': [{'kind': 'text', 'text': " Tesla's response and safety improvements\n- Other safety-related issues\n  - Suspension problems, sudden unintended acceleration, etc.\n  - Recalls and safety updates issued by Tesla\n\n# Technology and Innovation\n- Deep dive into Tesla's battery technology\n  - Battery chemistry, energy density, and lifespan\n  -"}], 'role': 'agent', 'taskId': 'd9982ce3-f0de-4901-a21f-250d27448bf1'}, 'state': 'working'}, 'taskId': 'd9982ce3-f0de-4901-a21f-250d27448bf1'}}
{'id': '00857233-1927-4cd4-ab2d-4714b166967b', 'jsonrpc': '2.0', 'result': {'contextId': 'f9788c09-9cf5-44f3-8f00-aacb4199a0e6', 'final': False, 'kind': 'status-update', 'status': {'message': {'contextId': 'f9788c09-9cf5-44f3-8f00-aacb4199a0e6', 'kind': 'message', 'messageId': '8e342058-3c6e-48ba-aeea-c994ecf20f7f', 'parts': [{'kind': 'text', 'text': " Tesla's battery manufacturing (Gigafactory)\n- Autopilot and Full Self-Driving (FSD)\n  - How Autopilot/FSD works: sensors, AI, software\n  - Ethical considerations of autonomous driving\n  - Future development of self-driving technology\n- Over-the-air"}], 'role': 'agent', 'taskId': 'd9982ce3-f0de-4901-a21f-250d27448bf1'}, 'state': 'working'}, 'taskId': 'd9982ce3-f0de-4901-a21f-250d27448bf1'}}
{'id': '00857233-1927-4cd4-ab2d-4714b166967b', 'jsonrpc': '2.0', 'result': {'contextId': 'f9788c09-9cf5-44f3-8f00-aacb4199a0e6', 'final': False, 'kind': 'status-update', 'status': {'message': {'contextId': 'f9788c09-9cf5-44f3-8f00-aacb4199a0e6', 'kind': 'message', 'messageId': 'b63bcae6-6c06-4809-b143-85f11beafd50', 'parts': [{'kind': 'text', 'text': " software updates\n  - How Tesla uses software updates to improve its cars\n  - Impact of software updates on vehicle performance and features\n  - Potential risks and benefits of frequent software updates\n\n# Production and Manufacturing\n- Tesla's manufacturing process\n  - Overview of Tesla's factories (Gigafactory locations)\n  "}], 'role': 'agent', 'taskId': 'd9982ce3-f0de-4901-a21f-250d27448bf1'}, 'state': 'working'}, 'taskId': 'd9982ce3-f0de-4901-a21f-250d27448bf1'}}
{'id': '00857233-1927-4cd4-ab2d-4714b166967b', 'jsonrpc': '2.0', 'result': {'contextId': 'f9788c09-9cf5-44f3-8f00-aacb4199a0e6', 'final': False, 'kind': 'status-update', 'status': {'message': {'contextId': 'f9788c09-9cf5-44f3-8f00-aacb4199a0e6', 'kind': 'message', 'messageId': 'dfc13533-0dc6-46fa-baed-6bfba9598098', 'parts': [{'kind': 'text', 'text': "- Manufacturing challenges and bottlenecks\n  - Quality control issues and concerns\n- Supply chain and sourcing of materials\n  - Sourcing of battery materials (lithium, nickel, cobalt)\n  - Ethical and environmental concerns related to mining\n  - Tesla's efforts to secure its supply chain\n\n# Environmental Impact\n- Electric"}], 'role': 'agent', 'taskId': 'd9982ce3-f0de-4901-a21f-250d27448bf1'}, 'state': 'working'}, 'taskId': 'd9982ce3-f0de-4901-a21f-250d27448bf1'}}
{'id': '00857233-1927-4cd4-ab2d-4714b166967b', 'jsonrpc': '2.0', 'result': {'contextId': 'f9788c09-9cf5-44f3-8f00-aacb4199a0e6', 'final': False, 'kind': 'status-update', 'status': {'message': {'contextId': 'f9788c09-9cf5-44f3-8f00-aacb4199a0e6', 'kind': 'message', 'messageId': '11dbb798-1567-47a4-bbe1-02ac8f16b6f4', 'parts': [{'kind': 'text', 'text': " vehicles and sustainability\n  - Environmental benefits of electric vehicles compared to gasoline cars\n  - Lifecycle emissions analysis of Tesla vehicles\n- Battery recycling and disposal\n  - Challenges of recycling lithium-ion batteries\n  - Tesla's battery recycling program\n  - Environmental impact of battery disposal\n\n# Financial and Market Analysis\n-"}], 'role': 'agent', 'taskId': 'd9982ce3-f0de-4901-a21f-250d27448bf1'}, 'state': 'working'}, 'taskId': 'd9982ce3-f0de-4901-a21f-250d27448bf1'}}
{'id': '00857233-1927-4cd4-ab2d-4714b166967b', 'jsonrpc': '2.0', 'result': {'contextId': 'f9788c09-9cf5-44f3-8f00-aacb4199a0e6', 'final': False, 'kind': 'status-update', 'status': {'message': {'contextId': 'f9788c09-9cf5-44f3-8f00-aacb4199a0e6', 'kind': 'message', 'messageId': 'c53ebe55-29e5-4fd9-aee4-be54400430d8', 'parts': [{'kind': 'text', 'text': " Tesla's financial performance\n  - Revenue, profit, and market capitalization\n  - Investment in research and development\n- Market position and competition\n  - Tesla's market share in the electric vehicle market\n  - Competition from other electric vehicle manufacturers (legacy automakers and startups)\n- Stock performance and investor sentiment\n  -"}], 'role': 'agent', 'taskId': 'd9982ce3-f0de-4901-a21f-250d27448bf1'}, 'state': 'working'}, 'taskId': 'd9982ce3-f0de-4901-a21f-250d27448bf1'}}
{'id': '00857233-1927-4cd4-ab2d-4714b166967b', 'jsonrpc': '2.0', 'result': {'contextId': 'f9788c09-9cf5-44f3-8f00-aacb4199a0e6', 'final': False, 'kind': 'status-update', 'status': {'message': {'contextId': 'f9788c09-9cf5-44f3-8f00-aacb4199a0e6', 'kind': 'message', 'messageId': '2f1b7f92-019b-436c-a5cd-a0f52c90b9ea', 'parts': [{'kind': 'text', 'text': " Analysis of Tesla's stock price and volatility\n  - Investor confidence in Tesla's future\n\n# Ethical and Social Implications\n- Elon Musk's influence and leadership\n  - Impact of Elon Musk's personality and decisions on Tesla\n  - Controversies and public perception of Elon Musk\n- Labor practices and"}], 'role': 'agent', 'taskId': 'd9982ce3-f0de-4901-a21f-250d27448bf1'}, 'state': 'working'}, 'taskId': 'd9982ce3-f0de-4901-a21f-250d27448bf1'}}
{'id': '00857233-1927-4cd4-ab2d-4714b166967b', 'jsonrpc': '2.0', 'result': {'contextId': 'f9788c09-9cf5-44f3-8f00-aacb4199a0e6', 'final': False, 'kind': 'status-update', 'status': {'message': {'contextId': 'f9788c09-9cf5-44f3-8f00-aacb4199a0e6', 'kind': 'message', 'messageId': '0516a7b2-6a3a-445c-85f2-1aa67e45c38a', 'parts': [{'kind': 'text', 'text': ' working conditions\n  - Allegations of poor working conditions at Tesla factories\n  - Unionization efforts and worker rights\n- Data privacy and security\n  - Collection and use of vehicle data\n  - Security vulnerabilities and hacking risks\n\n# The Future of Tesla\n- Upcoming models and innovations\n  - Cybertruck,'}], 'role': 'agent', 'taskId': 'd9982ce3-f0de-4901-a21f-250d27448bf1'}, 'state': 'working'}, 'taskId': 'd9982ce3-f0de-4901-a21f-250d27448bf1'}}
{'id': '00857233-1927-4cd4-ab2d-4714b166967b', 'jsonrpc': '2.0', 'result': {'contextId': 'f9788c09-9cf5-44f3-8f00-aacb4199a0e6', 'final': False, 'kind': 'status-update', 'status': {'message': {'contextId': 'f9788c09-9cf5-44f3-8f00-aacb4199a0e6', 'kind': 'message', 'messageId': 'cd0b8ea0-7c6c-40e8-8fe1-e6c8e4ff287e', 'parts': [{'kind': 'text', 'text': " Roadster, and other future vehicles\n  - New technologies and features in development\n- Tesla's role in the future of transportation\n  - Impact of Tesla on the automotive industry\n  - Vision for sustainable transportation and energy\n- Challenges and opportunities for Tesla\n  - Competition, regulation, and technological advancements\n  -"}], 'role': 'agent', 'taskId': 'd9982ce3-f0de-4901-a21f-250d27448bf1'}, 'state': 'working'}, 'taskId': 'd9982ce3-f0de-4901-a21f-250d27448bf1'}}
{'id': '00857233-1927-4cd4-ab2d-4714b166967b', 'jsonrpc': '2.0', 'result': {'contextId': 'f9788c09-9cf5-44f3-8f00-aacb4199a0e6', 'final': False, 'kind': 'status-update', 'status': {'message': {'contextId': 'f9788c09-9cf5-44f3-8f00-aacb4199a0e6', 'kind': 'message', 'messageId': '1bf6cb97-10e8-4a1a-b648-a52ff191aada', 'parts': [{'kind': 'text', 'text': " Potential risks and rewards for Tesla's future success\n"}], 'role': 'agent', 'taskId': 'd9982ce3-f0de-4901-a21f-250d27448bf1'}, 'state': 'working'}, 'taskId': 'd9982ce3-f0de-4901-a21f-250d27448bf1'}}
{'id': '00857233-1927-4cd4-ab2d-4714b166967b', 'jsonrpc': '2.0', 'result': {'artifact': {'artifactId': 'b066b569-91a9-4ad9-ac3f-376ba535c845', 'parts': [{'kind': 'text', 'text': "Okay, here's an outline for a Tesla Car Investigation. This outline could be used for a news report, a research paper, or even a fictional story. I've tried to cover a range of potential angles.\n\n# Overview of Tesla Cars\n- History of Tesla and its impact on the automotive industry\n- Different Tesla models and their key features (Model S, 3, X, Y, Cybertruck, etc.)\n- General technological innovations in Tesla vehicles (battery tech, Autopilot, etc.)\n\n# Safety Concerns and Investigations\n- Autopilot and Full Self-Driving (FSD) controversies\n  - History of Autopilot accidents and investigations\n  - Debate over the safety and reliability of Autopilot/FSD\n  - Regulatory scrutiny from NHTSA, NTSB, and other agencies\n- Battery fires and safety\n  - Instances of battery fires in Tesla vehicles\n  - Investigation into the cause of these fires\n  - Tesla's response and safety improvements\n- Other safety-related issues\n  - Suspension problems, sudden unintended acceleration, etc.\n  - Recalls and safety updates issued by Tesla\n\n# Technology and Innovation\n- Deep dive into Tesla's battery technology\n  - Battery chemistry, energy density, and lifespan\n  - Tesla's battery manufacturing (Gigafactory)\n- Autopilot and Full Self-Driving (FSD)\n  - How Autopilot/FSD works: sensors, AI, software\n  - Ethical considerations of autonomous driving\n  - Future development of self-driving technology\n- Over-the-air software updates\n  - How Tesla uses software updates to improve its cars\n  - Impact of software updates on vehicle performance and features\n  - Potential risks and benefits of frequent software updates\n\n# Production and Manufacturing\n- Tesla's manufacturing process\n  - Overview of Tesla's factories (Gigafactory locations)\n  - Manufacturing challenges and bottlenecks\n  - Quality control issues and concerns\n- Supply chain and sourcing of materials\n  - Sourcing of battery materials (lithium, nickel, cobalt)\n  - Ethical and environmental concerns related to mining\n  - Tesla's efforts to secure its supply chain\n\n# Environmental Impact\n- Electric vehicles and sustainability\n  - Environmental benefits of electric vehicles compared to gasoline cars\n  - Lifecycle emissions analysis of Tesla vehicles\n- Battery recycling and disposal\n  - Challenges of recycling lithium-ion batteries\n  - Tesla's battery recycling program\n  - Environmental impact of battery disposal\n\n# Financial and Market Analysis\n- Tesla's financial performance\n  - Revenue, profit, and market capitalization\n  - Investment in research and development\n- Market position and competition\n  - Tesla's market share in the electric vehicle market\n  - Competition from other electric vehicle manufacturers (legacy automakers and startups)\n- Stock performance and investor sentiment\n  - Analysis of Tesla's stock price and volatility\n  - Investor confidence in Tesla's future\n\n# Ethical and Social Implications\n- Elon Musk's influence and leadership\n  - Impact of Elon Musk's personality and decisions on Tesla\n  - Controversies and public perception of Elon Musk\n- Labor practices and working conditions\n  - Allegations of poor working conditions at Tesla factories\n  - Unionization efforts and worker rights\n- Data privacy and security\n  - Collection and use of vehicle data\n  - Security vulnerabilities and hacking risks\n\n# The Future of Tesla\n- Upcoming models and innovations\n  - Cybertruck, Roadster, and other future vehicles\n  - New technologies and features in development\n- Tesla's role in the future of transportation\n  - Impact of Tesla on the automotive industry\n  - Vision for sustainable transportation and energy\n- Challenges and opportunities for Tesla\n  - Competition, regulation, and technological advancements\n  - Potential risks and rewards for Tesla's future success\n"}]}, 'contextId': 'f9788c09-9cf5-44f3-8f00-aacb4199a0e6', 'kind': 'artifact-update', 'taskId': 'd9982ce3-f0de-4901-a21f-250d27448bf1'}}
{'id': '00857233-1927-4cd4-ab2d-4714b166967b', 'jsonrpc': '2.0', 'result': {'contextId': 'f9788c09-9cf5-44f3-8f00-aacb4199a0e6', 'final': True, 'kind': 'status-update', 'status': {'state': 'completed'}, 'taskId': 'd9982ce3-f0de-4901-a21f-250d27448bf1'}}

Process finished with exit code 0
```

# å¯¹äºæºå¸¦metadataçš„æ•°æ®ï¼Œå®ƒçš„æ•°æ®æµåŠ¨æ–¹å¼è¿‡ç¨‹æ˜¯ï¼Œåº•å±‚metadataå…ƒæ•°æ®çš„æµåŠ¨è¿‡ç¨‹ã€‚
1. a2a_client.py ï¼Œpayloadä¸­æºå¸¦metadata,ä¾‹å¦‚send_message_payloadä¸­

2. adk_agent_executor.pyä¸­çš„async def executeçš„context.message.metadataè·å–åˆ°å…ƒæ•°æ®ï¼Œasync def _process_requestçš„await self._upsert_sessionåœ¨åˆ›å»ºæ–°çš„sessionæ—¶,æŠŠå…ƒæ•°æ®æ”¾åˆ°stateä¸­ï¼Œapp_name=self.runner.app_name, user_id="self", session_id=session_id, state={"metadata":metadata}

3. agent.pyçš„before_model_callbackä¸­å¯ä»¥çœ‹åˆ°å…ƒæ•°æ®, callback_context.state.get("metadata")

4. å¦‚æœä½¿ç”¨äº†å·¥å…·ï¼Œé‚£ä¹ˆtool_contextä¸­çš„tool_context.state.get("metadata")å¯ä»¥è·å–åˆ°å…ƒæ•°æ®ï¼Œ

5. å·¥å…·è°ƒç”¨æ—¶çš„åŸä¿¡æ¯å¯ä»¥é™„è¿‘åˆ°metadataä¸­ï¼Œ metadata["tool_document_ids"] = document_ids
    tool_context.state["metadata"] = metadata

6. agent.pyçš„after_model_callbackå¯ä»¥çœ‹åˆ°metadata = callback_context.state.get("metadata")ä¿¡æ¯ï¼ŒåŒ…æ‹¬å·¥å…·æ›´æ–°çš„ç»“æœã€‚

7. adk_agent_executor.pyä¸­ä¸­çš„async def _process_requestçš„if event.is_final_response():ä¸­è·å–final_session = await self.runner.session_service.get_session(
                    app_name=self.runner.app_name, user_id="self", session_id=session_id
                )
                print("æœ€ç»ˆçš„sessionä¸­çš„ç»“æœfinal_sessionä¸­çš„state: ", final_session.state)
8. æœ€ç»ˆçš„å®¢æˆ·ç«¯æ‰“å°å‡ºmetadata, {'id': '57071402-98d3-459d-a447-cbdf384e8323', 'jsonrpc': '2.0', 'result': {'artifact': {'artifactId': '156b98ac-3aa6-412c-97e2-6dff3148c46b', 'metadata': {'user_data': 'hello', 'tool_document_ids': [0, 1, 2, 3]}, 'parts': [{'kind': 'text', 'text': '# ç”µåŠ¨æ±½è½¦å…¨çƒå¸‚åœºæ¦‚å†µ\n- å…¨çƒé”€é‡æŒç»­å¢é•¿ï¼Œæ–°å…´å¸‚åœºè¡¨ç°çªå‡º\n- ä¸­å›½å¼•é¢†å…¨çƒç”µåŠ¨æ±½è½¦å¸‚åœº\n- æ¬§ç¾å¸‚åœºå¢é•¿æ”¾ç¼“ï¼Œé¢ä¸´æŒ‘æˆ˜\n\n# ç”µåŠ¨æ±½è½¦æŠ€æœ¯ä¸æˆæœ¬\n- ç”µæ± æŠ€æœ¯è¿›æ­¥ä¸æˆæœ¬ä¸‹é™\n- å……ç”µåŸºç¡€è®¾æ–½çš„å®Œå–„ä¸åˆ›æ–°\n- ç”µåŠ¨å¡è½¦ç»æµæ€§æ”¹å–„ï¼Œé•¿é€”è¿è¾“æ½œåŠ›æ˜¾ç°\n\n# ç”µåŠ¨æ±½è½¦çš„æ¶ˆè´¹è€…æ¥å—åº¦\n- æ¶ˆè´¹è€…å¯¹ç”µåŠ¨æ±½è½¦çš„æ¥å—åº¦å­˜åœ¨åˆ†åŒ–\n- æ”¿ç­–ä¸è¡¥è´´å¯¹æ¶ˆè´¹è€…è´­ä¹°æ„æ„¿çš„å½±å“\n- ç»­èˆªé‡Œç¨‹å’Œç”µæ± è¡°å‡æ˜¯æ¶ˆè´¹è€…å…³æ³¨çš„é‡ç‚¹'}]}, 'contextId': 'cdbf96d6-8a35-40e2-b3cd-e026c2c446f1', 'kind': 'artifact-update', 'taskId': '3d5160e2-42ef-4244-872f-e23046b685f1'}}