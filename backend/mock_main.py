import asyncio
import json
from fastapi import FastAPI
from pydantic import BaseModel
from fastapi.responses import StreamingResponse
from fastapi.middleware.cors import CORSMiddleware

app = FastAPI()

# Allow CORS for the frontend development server
app.add_middleware(
    CORSMiddleware,
    allow_origins=["http://127.0.0.1:5173"],
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)

class AipptRequest(BaseModel):
    content: str
    language: str
    model: str
    stream: bool

# The example markdown response provided by the user
markdown_response = """# 2025科技前沿动态

## 人工智能与机器学习
### 大型语言模型的突破
- GPT-6实现多模态理解与生成，文本、图像、音频无缝融合
- 多语言处理能力达到人类水平，支持100+种语言的深度理解
- 模型参数优化，训练能耗降低70%，推理速度提升3倍
- 自监督学习能力增强，减少标注数据依赖达90%
- 伦理安全框架完善，内置事实核查机制

### 通用人工智能进展
- AGI系统在有限领域实现超越专家水平的表现
- 多智能体协作系统解决复杂问题的能力显著提升
- 元学习算法实现快速适应新任务的能力
- 神经符号AI结合逻辑推理与神经网络优势
- 自主AI系统获得有限环境下的决策能力

### 人工智能伦理与治理
- 全球AI治理框架初步建立，包含跨国合作机制
- AI透明度与可解释性成为强制性要求
- 偏见检测与缓解技术成熟，减少算法歧视
- 数据隐私保护与AI应用的平衡机制形成
- AI安全研究重点关注对抗性攻击防御

## 量子计算与量子互联网
### 量子计算硬件突破
- 50+量子比特量子处理器实现稳定运行
- 量子纠错技术取得重大进展，错误率降低至10^-6
- 高温超导量子芯片实现室温量子计算原型
- 光量子计算机处理特定问题的速度提升100倍
- 量子-经典混合计算架构走向实用化

### 量子互联网发展
- 量子密钥分发网络覆盖主要城市，实现安全通信
- 量子中继器技术突破，量子态传输距离达1000公里
- 量子路由器与量子交换机标准形成
- 全球量子互联网基础设施初步规划完成
- 量子安全协议成为金融、政府通信标准

### 量子计算应用探索
- 药物分子模拟实现原子级别精确计算
- 优化算法解决物流、能源分配等复杂问题
- 人工智能加速器利用量子计算提升模型训练速度
- 金融风险分析模型计算效率提升1000倍
- 材料科学发现新型超导材料与催化剂"""

json_response_content = """{"type": "cover", "data": {"title": "2025科技前沿动态", "text": "探索人工智能、量子计算、生物技术等领域的最新突破与未来发展方向"}}
{"type": "contents", "data": {"items": ["人工智能新突破", "量子计算商业化进程", "生物技术与医疗革新", "新能源与可持续发展", "通信技术与连接未来", "先进制造与机器人技术"]}}
{"type": "transition", "data": {"title": "人工智能新突破", "text": "人工智能技术实现多模态融合、参数效率优化与个性化服务，推动各行业创新应用"}}
{"type": "content", "data": {"title": "大语言模型的进化", "items": [{"title": "多模态融合", "text": "大语言模型已实现文本、图像、音频等多模态信息的深度融合理解，使AI系统能够更接近人类感知世界的方式，处理复杂场景下的信息整合与推理任务。"}, {"title": "参数效率优化", "text": "通过模型架构创新与训练算法优化，新一代大语言模型显著降低了训练成本，同时保持了甚至提升了模型性能，使更多研究机构和企业能够参与AI技术研发与应用。"}, {"title": "自主推理能力", "text": "AI系统的自主推理和规划能力显著增强，能够基于复杂环境做出更接近人类思维方式的决策，在科学研究、问题解决等领域展现出前所未有的潜力。"}, {"title": "个性化AI助手", "text": "AI助手已实现高度个性化，能够学习用户习惯、偏好和需求，提供定制化服务，成为日常生活和工作的得力助手，显著提升个人效率与体验。"}, {"title": "安全伦理框架", "text": "随着AI应用的普及，安全与伦理框架逐步完善，通过算法优化、数据治理和监管措施，有效减少AI系统中的偏见与滥用风险，促进技术健康发展。"}]}}
{"type": "content", "data": {"title": "生成式AI的商业应用", "items": [{"title": "内容创作变革", "text": "生成式AI已全面变革内容创作行业，自动化生成高质量文章、视频和音乐的能力显著提升，大幅降低了内容生产成本，提高了创作效率，为创意产业带来新的发展机遇。"}, {"title": "药物研发加速", "text": "AI技术显著缩短了药物研发周期，通过分子结构设计与药物特性预测，加速了新药发现过程，为治疗复杂疾病提供了更多可能性，降低了研发成本与风险。"}, {"title": "工业设计优化", "text": "在工业设计领域，生成式AI实现了快速原型迭代和优化，能够根据需求自动生成多种设计方案，并评估其可行性与性能，大幅提高了设计效率与创新性。"}, {"title": "精准营销投放", "text": "生成式AI在营销领域实现千人千面的个性化广告投放，通过分析用户行为与偏好，精准匹配内容与目标受众，显著提升了营销效果与转化率。"}, {"title": "自适应教育", "text": "教育领域通过AI提供自适应学习路径和智能辅导系统，根据学生能力与学习进度动态调整内容难度与教学方式，实现个性化教育，提升学习效果。"}]}}
{"type": "content", "data": {"title": "AI与脑科学的交叉研究", "items": [{"title": "脑机接口突破", "text": "脑机接口技术取得重大突破，实现了更高精度的思维解码，使大脑信号能够更准确地转化为控制指令，为医疗康复和人机交互开辟了新途径。"}, {"title": "神经形态芯片", "text": "神经形态芯片模仿人脑结构与工作机制，大幅提升了能效比，在处理复杂模式识别与学习任务时展现出显著优势，为低功耗AI计算提供了新方向。"}, {"title": "脑疾病精准医疗", "text": "AI辅助脑疾病诊断和治疗系统已实现临床应用，通过分析神经影像与脑电数据，提高了阿尔茨海默症、帕金森病等神经系统疾病的早期诊断准确性与治疗效果。"}, {"title": "意识上传探索", "text": "意识上传与数字永生概念已从理论走向初步实验阶段，通过脑部扫描与神经网络建模，科学家们正在探索保存人类认知特征的可能性，为未来脑机融合奠定基础。"}, {"title": "认知科学启发", "text": "认知科学研究为AI提供了新的理论框架与算法启发，而AI的发展也反过来促进了脑科学研究，形成双向促进的良性循环，推动了两个领域的共同进步。"}]}}
{"type": "transition", "data": {"title": "量子计算商业化进程", "text": "量子计算机硬件技术突破、量子算法应用开发及生态系统建设共同推动量子计算从实验室走向商业化应用"}}
{"type": "content", "data": {"title": "量子计算机硬件发展", "items": [{"title": "超导量子计算", "text": "超导量子计算机已实现100+量子比特的稳定运行，量子相干时间显著延长，错误率持续下降，为实现大规模量子计算奠定了基础，展示了在特定算法上的计算优势。"}, {"title": "离子阱技术", "text": "离子阱量子计算机在量子比特操控精度和相干时间方面展现出明显优势，单双量子门操作保真度超过99.9%，为构建容错量子计算机提供了可靠技术路径。"}, {"title": "光量子计算", "text": "光量子计算机在特定算法上已展示量子优势，利用光子的量子特性实现并行计算，在密码分析和优化问题处理方面展现出独特潜力，室温运行条件简化了系统部署。"}, {"title": "量子纠错突破", "text": "量子纠错技术取得重大突破，表面码和容错量子计算方案的实现大幅降低了量子计算错误率，为实用化量子计算机铺平了道路，延长了量子态的相干时间。"}, {"title": "量子云服务", "text": "量子计算云服务已成为企业研发新渠道，多家科技公司推出量子计算云平台，使研究机构和企业能够通过互联网访问量子计算资源，降低技术门槛，加速应用开发。"}]}}
{"type": "content", "data": {"title": "量子算法与应用", "items": [{"title": "量子化学模拟", "text": "量子化学模拟算法能够精确模拟分子结构和化学反应过程，加速新材料和药物发现，将传统需要数月甚至数年的计算工作缩短至数小时或数天，显著提高了研发效率。"}, {"title": "量子优化算法", "text": "量子优化算法如QAOA和VQE能够有效解决物流、金融等领域的复杂优化问题，在投资组合优化、供应链管理和交通调度等场景中展现出比经典算法更高的效率。"}, {"title": "量子机器学习", "text": "量子机器学习算法在处理高维度数据时展现出显著优势，通过量子特征映射和量子神经网络，能够更有效地识别复杂模式，为图像识别、自然语言处理等领域提供新方法。"}, {"title": "后量子密码学", "text": "面对量子计算对传统密码体系的威胁，后量子密码学加速发展，格密码、基于哈希的签名和多项式方案等新型密码算法已形成标准化草案，保障信息安全过渡。"}, {"title": "量子人工智能", "text": "量子人工智能结合传统AI与量子计算优势，能够解决传统AI难以处理的复杂问题，如量子系统优化、高维空间搜索和复杂网络分析，为科学研究提供新工具。"}]}}
{"type": "content", "data": {"title": "量子生态系统建设", "items": [{"title": "企业研究中心", "text": "主要科技公司如IBM、谷歌、微软等纷纷建立量子计算研究中心，投入巨额研发资源，推动量子硬件、软件和应用开发，形成了产学研紧密结合的创新生态系统。"}, {"title": "编程工具成熟", "text": "量子编程语言如Qiskit、Cirq和Q#日趋成熟，提供高效的量子电路描述与执行环境，开发工具链不断完善，降低了量子算法开发门槛，加速了应用创新。"}, {"title": "人才培养体系", "text": "量子教育和人才培养体系逐步完善，多所高校设立量子信息专业，在线课程和认证项目普及，企业量子培训项目兴起，为量子产业输送专业人才。"}, {"title": "产业联盟形成", "text": "量子产业联盟在全球范围内形成，推动技术标准化、资源共享和商业化合作，促进跨领域应用开发，加速量子技术从研究向产业转化。"}, {"title": "政府战略投入", "text": "各国政府加大量子技术投入，制定量子发展战略和政策，设立专项资金支持量子研究，构建国家级量子基础设施，争夺未来科技竞争制高点。"}]}}
{"type": "transition", "data": {"title": "生物技术与医疗革新", "text": "基因编辑技术突破、精准医疗方案普及与生物合成技术发展共同推动医疗健康领域进入精准化与个性化新时代"}}
{"type": "content", "data": {"title": "基因编辑技术突破", "items": [{"title": "精准基因编辑", "text": "CRISPR-Cas9技术实现更精准的基因编辑，显著减少脱靶效应，新型碱基编辑和质粒编辑系统进一步提高了编辑精度，为基因治疗提供了更安全有效的工具。"}, {"title": "基因治疗应用", "text": "基于基因编辑的治疗遗传病已进入临床应用阶段，镰状细胞贫血、囊性纤维化等单基因疾病通过CRISPR疗法取得显著疗效，为患者带来治愈希望。"}, {"title": "农业基因编辑", "text": "体外基因编辑技术在农业领域广泛应用，培育出抗病虫害、耐旱高产作物品种，减少农药使用，提高粮食产量，为应对全球粮食安全挑战提供解决方案。"}, {"title": "表观遗传调控", "text": "表观遗传编辑技术能够精确调控基因表达而不改变DNA序列，在治疗癌症、神经系统疾病等领域展现出潜力，为疾病治疗提供新思路。"}, {"title": "基因驱动技术", "text": "基因驱动技术在消除疾病传播媒介方面取得进展，通过修改蚊虫等病原体携带者的基因，可有效阻断疟疾、登革热等疾病传播，为全球公共卫生提供新工具。"}]}}
{"type": "content", "data": {"title": "精准医疗与个性化治疗", "items": [{"title": "基因组学方案", "text": "基于基因组学的个性化治疗方案已逐渐普及，通过分析患者基因变异特征，定制针对性治疗策略，显著提高了癌症、心血管疾病等复杂疾病的治疗效果。"}, {"title": "肿瘤DNA检测", "text": "循环肿瘤DNA技术实现癌症早期筛查和监测，通过检测血液中的肿瘤DNA片段，能够在临床症状出现前发现癌症迹象，并实时评估治疗效果，指导临床决策。"}, {"title": "微生物组研究", "text": "微生物组研究揭示肠道健康与多种疾病的关联，通过调控肠道菌群微生态，可有效治疗炎症性肠病、代谢综合征等疾病，为疾病预防和治疗提供新靶点。"}, {"title": "AI辅助诊断", "text": "人工智能辅助诊断系统结合医学影像、电子病历和基因数据，大幅提高疾病预测准确性，早期发现癌症、神经系统疾病等复杂疾病，改善患者预后。"}, {"title": "细胞疗法突破", "text": "基因编辑细胞疗法在免疫治疗领域取得突破，CAR-T细胞疗法在血液肿瘤治疗中展现显著效果，新型TCR-T和NK细胞疗法正在扩展实体瘤治疗应用范围。"}]}}
{"type": "content", "data": {"title": "生物合成与生物制造", "items": [{"title": "合成生命体", "text": "人工设计和合成生命体成为可能，科学家能够从头设计基因组并创造全新微生物，这些合成生物可用于生产药物、材料和环境修复，拓展生命应用边界。"}, {"title": "生物打印技术", "text": "生物打印技术实现器官和组织的精准制造，结合患者细胞与3D打印技术，能够构建功能性组织模型用于药物测试，未来有望解决器官移植短缺问题。"}, {"title": "微生物细胞工厂", "text": "微生物细胞工厂通过合成生物学方法改造微生物代谢途径，高效生产高价值化合物和药物，如青蒿素、胰岛素等，显著降低生产成本和提高产量。"}, {"title": "植物优化改造", "text": "合成生物学技术用于改造植物基因组，提高作物产量和抗逆性，培育出抗旱、抗病虫害和高营养品种，增强农业可持续性，应对气候变化挑战。"}, {"title": "生物基材料", "text": "生物基材料替代传统塑料成为现实，通过微生物发酵和酶催化技术生产可降解塑料、生物燃料和环保材料，显著减少环境污染，推动循环经济发展。"}]}}
{"type": "transition", "data": {"title": "新能源与可持续发展", "text": "清洁能源技术革新、能源存储系统优化与碳捕获技术应用共同构建低碳可持续发展的未来能源体系"}}
{"type": "content", "data": {"title": "清洁能源技术革新", "items": [{"title": "钙钛矿太阳能", "text": "钙钛矿太阳能电池效率突破30%，同时制造成本持续下降，柔性和半透明特性使其应用场景多元化，有望在未来十年内实现大规模商业化部署。"}, {"title": "核聚变突破", "text": "核聚变能源实验取得突破，能量增益比显著提高，等离子体约束时间延长，清洁安全可控的核聚变能有望在21世纪中叶实现商业化应用，解决能源危机。"}, {"title": "氢燃料电池", "text": "氢燃料电池技术实现商业化，续航里程大幅提升，加氢基础设施逐步完善，在重型运输和长途客运领域展现出替代传统内燃机的潜力，助力碳减排。"}, {"title": "海上浮式风电", "text": "海上浮式风电场建设加速，拓展清洁能源开发空间，深水风电技术突破使风能资源丰富的海域得以开发利用，大幅提高风电装机容量。"}, {"title": "地热能技术", "text": "地热能开发技术进步，提高利用效率，增强型地热系统(EGS)技术突破使非传统地热区也可实现地热发电，为清洁稳定电力供应提供新选择。"}]}}
{"type": "content", "data": {"title": "能源存储与管理", "items": [{"title": "固态电池", "text": "固态电池技术解决传统锂电池安全性问题，能量密度提升50%以上，充电速度加快，使用寿命延长，有望在未来五年内实现大规模产业化应用。"}, {"title": "液流电池", "text": "液流电池在大规模储能领域展现优势，能量容量与功率解耦，安全性高，寿命长，适用于电网级储能系统，促进可再生能源消纳和电网稳定运行。"}, {"title": "智能电网", "text": "智能电网整合分布式能源资源，通过先进通信和控制技术提高系统稳定性，实现需求侧响应和实时调度，优化能源配置效率，降低碳排放。"}, {"title": "能源区块链", "text": "能源区块链实现点对点能源交易，建立去中心化的能源市场，使分布式能源生产者和消费者直接交易，提高能源效率，促进能源民主化和普惠能源。"}, {"title": "AI能源优化", "text": "人工智能算法优化能源使用效率，通过智能预测和动态调整，减少能源浪费，建筑能源管理系统可降低能耗20-30%，工业过程优化可提高能源利用15-25%。"}]}}
{"type": "content", "data": {"title": "碳捕获与利用技术", "items": [{"title": "直接空气捕获", "text": "直接空气捕获(DAC)技术成本降低70%，实现规模化应用，模块化设计使部署更加灵活，有望在碳中和技术路线中发挥关键作用，实现负排放。"}, {"title": "碳矿化技术", "text": "碳矿化技术将二氧化碳转化为建筑材料，如碳酸钙混凝土，既减少碳排放又创造经济价值，碳化产物强度和耐久性优于传统材料，具有产业化前景。"}, {"title": "人工光合作用", "text": "人工光合作用技术模拟自然光合过程，将二氧化碳转化为燃料和化学品，利用太阳能实现碳资源循环利用，为碳中和提供技术支撑。"}, {"title": "企业碳中和技术", "text": "碳中和技术成为企业减排重要手段，碳捕集利用与封存(CCUS)技术在钢铁、水泥等难减排行业规模化应用，配合碳抵消机制助力企业实现碳中和目标。"}, {"title": "碳交易市场", "text": "全球碳交易市场机制不断完善，碳定价机制日益成熟，激励企业投资减排技术，促进碳减排技术创新和商业模式创新，推动绿色低碳转型。"}]}}
{"type": "transition", "data": {"title": "通信技术与连接未来", "text": "6G网络发展、沉浸式技术演进与边缘计算创新共同构建万物互联的智能通信新生态"}}
{"type": "content", "data": {"title": "6G网络与卫星互联网", "items": [{"title": "6G原型系统", "text": "6G网络原型已展示1Tbps传输速率，亚毫秒级延迟和厘米级定位精度，太赫兹通信、智能超表面等关键技术突破，为未来智能社会提供强大通信基础设施。"}, {"title": "太赫兹通信", "text": "太赫兹通信技术实现高速数据传输，频谱资源丰富，支持Tbps级传输速率，在短距离高速通信场景应用前景广阔，为未来6G核心频段技术。"}, {"title": "卫星互联网", "text": "低轨道卫星互联网实现全球无缝覆盖，提供高速、低延迟互联网服务，解决偏远地区连接问题，与传统地面网络形成互补，构建全球一体化网络。"}, {"title": "空天地一体化", "text": "空天地一体化网络整合卫星、高空平台和地面网络，支持万物互联场景，提供无缝切换和协同服务，满足垂直行业差异化需求，推动数字经济全球化发展。"}, {"title": "量子通信网络", "text": "量子通信卫星网络实现全球安全通信，基于量子纠缠原理的信息传输具有理论上无条件安全性，为金融、政务等高安全性要求领域提供通信保障。"}]}}
{"type": "content", "data": {"title": "沉浸式技术演进", "items": [{"title": "轻量化AR眼镜", "text": "轻量化AR眼镜实现全天候佩戴，重量减轻至100克以下，续航时间超过10小时，显示亮度提升，功耗降低，成为下一代移动计算平台。"}, {"title": "脑机接口VR", "text": "脑机接口结合VR实现更自然的交互方式，通过神经信号直接控制虚拟环境，减少物理输入设备依赖，为残障人士提供新型交互手段。"}, {"title": "数字孪生技术", "text": "数字孪生技术实现物理世界的精确复制，构建高保真虚拟模型，支持全生命周期管理，在智能制造、智慧城市等领域实现虚实融合决策优化。"}, {"title": "全息通信", "text": "全息通信技术实现真实感远程会议，3D全息投影与实时动作捕捉结合，创造面对面交流的沉浸体验，大幅提升远程协作效率与体验。"}, {"title": "元宇宙社交", "text": "元宇宙社交平台成为新社交方式，融合虚拟身份、经济系统和社交规则，构建超越物理限制的社交空间，为社交互动、商业活动和知识共享提供新范式。"}]}}
{"type": "content", "data": {"title": "边缘计算与物联网", "items": [{"title": "边缘AI芯片", "text": "边缘AI芯片实现本地化智能处理，计算性能提升10倍，功耗降低50%，支持实时推理，满足自动驾驶、工业视觉等低延迟应用需求，减少云端依赖。"}, {"title": "物联网安全升级", "text": "物联网安全协议升级，采用硬件级安全芯片和零信任架构，保障设备安全，端到端加密和区块链技术相结合，有效防范数据泄露和设备劫持攻击。"}, {"title": "低功耗广域网", "text": "低功耗广域网技术支持大规模传感器部署，单节点电池寿命延长至10年以上，覆盖范围扩大至10公里，为智慧农业、环境监测等场景提供可靠连接。"}, {"title": "工业互联网平台", "text": "工业互联网平台实现设备全生命周期管理，整合生产数据、供应链信息和市场需求，优化资源配置，预测性维护减少停机时间30%以上。"}, {"title": "智能城市互联", "text": "智能城市基础设施互联互通，提升城市治理效率，交通、能源、水务等系统协同优化，减少拥堵20%，降低能耗15%，提高公共服务响应速度。"}]}}
{"type": "transition", "data": {"title": "先进制造与机器人技术", "text": "3D打印技术革新、工业机器人进化与智能制造系统升级共同推动制造业向智能化、定制化方向发展"}}
{"type": "content", "data": {"title": "3D打印技术革新", "items": [{"title": "金属3D打印", "text": "金属3D打印实现大型复杂结构一体化制造，打印尺寸扩大至数米级，材料性能达到锻件标准，广泛应用于航空航天、医疗植入体等高端制造领域。"}, {"title": "生物3D打印", "text": "生物3D打印技术打印功能性组织和器官，细胞存活率超过90%，血管网络结构构建成功，为器官移植和药物测试提供新解决方案，推动再生医学发展。"}, {"title": "多材料打印", "text": "多材料3D打印创造具有特殊性能的复合材料，不同材料在同一构件中无缝结合，实现梯度材料和多性能集成，满足航空航天、汽车等高端应用需求。"}, {"title": "纳米级3D打印", "text": "纳米级3D打印实现微米级精度的复杂结构，分辨率达到10纳米级别，在光学器件、电子元件和生物传感器等领域展现出独特优势，推动微型化设备发展。"}, {"title": "4D打印技术", "text": "4D打印技术实现打印物的自主变形和响应，结合智能材料与环境刺激响应机制，创造能够自适应变化的构件，在医疗植入、建筑结构和机器人领域应用前景广阔。"}]}}
{"type": "content", "data": {"title": "工业机器人进化", "items": [{"title": "人机协作", "text": "人机协作机器人更安全、更智能，配备力反馈和视觉感知系统，能够与人类在同一空间安全工作，任务执行精度提高0.1毫米，大幅提升生产灵活性。"}, {"title": "柔性机器人", "text": "柔性机器人适应非结构化环境，采用仿生结构和软体材料，能够在复杂和不确定环境中执行任务，在医疗手术、灾难救援等领域应用前景广阔。"}, {"title": "自主学习能力", "text": "自主学习机器人能够适应新任务，通过强化学习和迁移学习技术，无需重新编程即可执行新任务，减少70%的部署时间，提高生产系统适应性。"}, {"title": "群体机器人系统", "text": "群体机器人系统实现协同作业，通过分布式算法实现自组织行为，在搜索救援、环境监测和农业采摘等场景中展现出高效协作能力，任务完成效率提升50%。"}, {"title": "云端赋能机器人", "text": "云端赋能的机器人共享知识和经验，通过云平台获取更新和协作，实现技能迁移和知识传承，机器人之间学习效率提高80%，加速技术积累与创新。"}]}}
{"type": "content", "data": {"title": "智能制造系统", "items": [{"title": "数字孪生工厂", "text": "数字孪生工厂实现全流程模拟和优化，构建与物理工厂完全对应的虚拟模型，支持生产过程预测性分析和优化，提高设备利用率25%，减少停机时间30%。"}, {"title": "自适应制造系统", "text": "自适应制造系统能够根据需求调整生产流程，动态重构生产线布局和工艺参数，响应市场需求变化，产品切换时间缩短60%，提高生产灵活性。"}, {"title": "AI质量控制", "text": "人工智能驱动的质量控制实现零缺陷生产，基于深度学习的视觉检测系统缺陷识别率提高99.5%，实时反馈调整工艺参数，降低不良品率90%。"}, {"title": "供应链智能优化", "text": "供应链智能优化降低库存和物流成本，预测准确率提高40%，库存周转率提升35%，物流路径优化减少运输时间20%，降低碳排放15%。"}, {"title": "可持续制造技术", "text": "可持续制造技术减少能源消耗和废弃物产生，通过循环经济设计，材料利用率提高30%，能源消耗降低25%，废弃物减少50%，实现绿色制造目标。"}]}}
{"type": "end"}
"""

async def stream_generator():
    """A generator that yields parts of the markdown response to simulate streaming."""
    for char in markdown_response:
        yield char
        await asyncio.sleep(0.01) # Simulate network latency

@app.post("/tools/aippt_outline")
async def aippt_outline(request: AipptRequest):
    if request.stream:
        return StreamingResponse(stream_generator(), media_type="text/plain")
    else:
        return {"text": markdown_response}

class AipptContentRequest(BaseModel):
    content: str


def parse_markdown_to_slides(markdown_text):
    slides = []
    lines = markdown_text.strip().split('\n')

    # Find title
    main_title = ""
    for line in lines:
        if line.startswith('# '):
            main_title = line[2:].strip()
            # Use a generic subtitle
            slides.append({"type": "cover", "data": {"title": main_title, "text": "A presentation generated by AI"}})
            break

    # Find sections for contents page
    sections = []
    for line in lines:
        if line.startswith('## '):
            sections.append(line[2:].strip())
    if sections:
        slides.append({"type": "contents", "data": {"items": sections}})

    # Process each section and its subsections
    current_section_title = ""
    current_subsection_title = ""
    current_items = []

    for line in lines:
        line = line.strip()
        if line.startswith('## '):
            if current_subsection_title:
                slide_items = []
                for item in current_items:
                    slide_items.append({"title": item, "text": f"Detailed content about {item}"})
                slides.append({"type": "content", "data": {"title": current_subsection_title, "items": slide_items}})
                current_items = []

            current_section_title = line[2:].strip()
            current_subsection_title = ""
            slides.append({"type": "transition", "data": {"title": current_section_title, "text": f"Exploring the topic of {current_section_title}"}})
        elif line.startswith('### '):
            if current_subsection_title:
                slide_items = []
                for item in current_items:
                    slide_items.append({"title": item, "text": f"Detailed content about {item}"})
                slides.append({"type": "content", "data": {"title": current_subsection_title, "items": slide_items}})
                current_items = []
            current_subsection_title = line[4:].strip()
        elif line.startswith('- '):
            if current_subsection_title:
                current_items.append(line[2:].strip())

    if current_subsection_title:
        slide_items = []
        for item in current_items:
            slide_items.append({"title": item, "text": f"Detailed content about {item}"})
        slides.append({"type": "content", "data": {"title": current_subsection_title, "items": slide_items}})

    slides.append({"type": "end"})
    return slides


async def aippt_content_streamer(markdown_content: str):
    """Parses markdown and streams slide data as JSON objects."""
    slides = parse_markdown_to_slides(markdown_content)
    for slide in slides:
        yield json.dumps(slide, ensure_ascii=False) + '\n'
        await asyncio.sleep(0.1)

@app.post("/tools/aippt")
async def aippt_content(request: AipptContentRequest):
    return StreamingResponse(aippt_content_streamer(request.content), media_type="application/json; charset=utf-8")

if __name__ == "__main__":
    import uvicorn
    uvicorn.run(app, host="127.0.0.1", port=6800)

